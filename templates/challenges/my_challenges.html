{% extends "base.html" %}

{% block title %}My Challenges - HabitFlow{% endblock %}

{% block extra_css %}
<style>
    h1, h2, h3, h4, h5 {
        color: var(--text-primary);
    }

    .page-header {
        margin-bottom: 30px;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
    }

    .page-subtitle {
        color: #6b7280;
        font-size: 1.1rem;
    }

    body.dark-mode .page-subtitle {
        color: #9ca3af !important;
    }

    .challenge-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px var(--shadow-color);
        position: relative;
        overflow: hidden;
    }

    .challenge-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
    }

    .challenge-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(124, 58, 237, 0.15);
        border-color: rgba(124, 58, 237, 0.3);
    }

    .challenge-icon {
        font-size: 2.5rem;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }

    .challenge-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .challenge-title {
        font-size: 1.4rem;
        font-weight: 600;
        margin: 0 0 5px 0;
        color: var(--text-primary);
    }

    .challenge-type-badge {
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .competitive-badge {
        background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
        color: white;
    }

    .collaborative-badge {
        background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
        color: white;
    }

    .challenge-stats {
        display: flex;
        gap: 20px;
        margin: 15px 0;
        flex-wrap: wrap;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .stat-label {
        color: #6b7280;
        font-size: 0.9rem;
    }

    .stat-value {
        font-weight: 600;
        color: #7c3aed;
        font-size: 1.1rem;
    }

    body.dark-mode .stat-label {
        color: #9ca3af;
    }

    .challenge-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 15px;
    }

    .btn-challenge {
        background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .btn-challenge:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
        color: white;
    }

    .btn-challenge-outline {
        background: transparent;
        color: #7c3aed;
        border: 2px solid #7c3aed;
        box-shadow: none;
    }

    .btn-challenge-outline:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
        color: white;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: var(--card-bg);
        border-radius: 15px;
        border: 2px dashed var(--border-color);
    }

    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        filter: drop-shadow(0 2px 8px rgba(0,0,0,0.1));
    }

    .empty-state h3 {
        color: var(--text-primary);
        margin-bottom: 10px;
    }

    .empty-state p {
        color: #6b7280;
        margin-bottom: 25px;
    }

    body.dark-mode .empty-state p {
        color: #9ca3af;
    }

    .create-challenge-btn {
        background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
        color: white;
        padding: 15px 40px;
        font-size: 1.1rem;
        border-radius: 12px;
        border: none;
        font-weight: 700;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
    }

    .create-challenge-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
        color: white;
    }

    .nav-tabs .nav-link {
        color: #6b7280;
        border: none;
        border-bottom: 3px solid transparent;
        padding: 12px 24px;
        font-weight: 600;
    }

    .nav-tabs .nav-link:hover {
        color: #7c3aed;
        border-bottom-color: rgba(124, 58, 237, 0.3);
    }

    .nav-tabs .nav-link.active {
        color: #7c3aed;
        border-bottom-color: #7c3aed;
        background: none;
    }

    body.dark-mode .nav-tabs .nav-link {
        color: #9ca3af;
    }

    body.dark-mode .nav-tabs .nav-link.active {
        color: #a78bfa;
        border-bottom-color: #a78bfa;
    }

    .premium-badge {
        background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        color: white;
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 700;
        margin-left: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Page Header -->
    <div class="row page-header">
        <div class="col-md-12 d-flex justify-content-between align-items-center">
            <div>
                <h1 class="page-title">My Challenges</h1>
                <p class="page-subtitle">Compete or collaborate with friends on habit goals</p>
            </div>
            {% if current_user.is_premium_active() %}
                <a href="{{ url_for('challenges.create') }}" class="btn-challenge">
                    <span>+</span> Create Challenge
                </a>
            {% else %}
                <a href="{{ url_for('profile.subscription') }}" class="btn-challenge" style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);">
                    <span>üåü</span> Upgrade to Create
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#created">
                Challenges I Created ({{ created_challenges|length }})
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#joined">
                Challenges I Joined ({{ joined_challenges|length }})
            </a>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Created Challenges Tab -->
        <div id="created" class="tab-pane fade show active">
            {% if created_challenges %}
                {% for challenge in created_challenges %}
                <div class="challenge-card">
                    <div class="challenge-header">
                        <div class="d-flex align-items-center gap-3">
                            <div class="challenge-icon">{{ challenge.icon }}</div>
                            <div>
                                <h3 class="challenge-title">{{ challenge.name }}</h3>
                                <span class="challenge-type-badge {% if challenge.challenge_type == 'competitive' %}competitive-badge{% else %}collaborative-badge{% endif %}">
                                    {% if challenge.challenge_type == 'competitive' %}üèÜ Competitive{% else %}ü§ù Collaborative{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>

                    {% if challenge.description %}
                    <p style="color: #6b7280; margin: 15px 0;">{{ challenge.description }}</p>
                    {% endif %}

                    <div class="challenge-stats">
                        <div class="stat-item">
                            <span class="stat-label">Participants:</span>
                            <span class="stat-value">{{ challenge.participants.filter_by(status='active').count() }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Goal:</span>
                            <span class="stat-value">{{ challenge.goal_type|replace('_', ' ')|title }}</span>
                        </div>
                        {% if challenge.goal_target %}
                        <div class="stat-item">
                            <span class="stat-label">Target:</span>
                            <span class="stat-value">{{ challenge.goal_target }}</span>
                        </div>
                        {% endif %}
                        {% if created_participants[challenge.id] %}
                        <div class="stat-item">
                            <span class="stat-label">Your Streak:</span>
                            <span class="stat-value">{{ created_participants[challenge.id].current_streak }} üî•</span>
                        </div>
                        {% endif %}
                    </div>

                    <div class="challenge-actions">
                        <a href="{{ url_for('challenges.detail', challenge_id=challenge.id) }}" class="btn-challenge">
                            View Challenge
                        </a>
                        <a href="{{ url_for('challenges.edit', challenge_id=challenge.id) }}" class="btn-challenge-outline btn-challenge">
                            <span>‚úèÔ∏è</span> Edit
                        </a>
                        <a href="{{ url_for('challenges.invite', challenge_id=challenge.id) }}" class="btn-challenge-outline btn-challenge">
                            <span>üìß</span> Invite Friends
                        </a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üéØ</div>
                    <h3>No Challenges Created Yet</h3>
                    <p>Create your first challenge and invite friends to join!</p>
                    {% if current_user.is_premium_active() %}
                        <a href="{{ url_for('challenges.create') }}" class="create-challenge-btn">
                            Create Your First Challenge
                        </a>
                    {% else %}
                        <p style="margin-top: 20px;">
                            <span class="premium-badge" style="padding: 8px 20px; font-size: 1rem;">Premium Feature</span>
                        </p>
                        <p style="margin-top: 15px;">Upgrade to premium to create unlimited challenges!</p>
                        <a href="{{ url_for('profile.subscription') }}" class="create-challenge-btn">
                            Upgrade to Premium
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <!-- Joined Challenges Tab -->
        <div id="joined" class="tab-pane fade">
            {% if joined_challenges %}
                {% for challenge in joined_challenges %}
                <div class="challenge-card">
                    <div class="challenge-header">
                        <div class="d-flex align-items-center gap-3">
                            <div class="challenge-icon">{{ challenge.icon }}</div>
                            <div>
                                <h3 class="challenge-title">{{ challenge.name }}</h3>
                                <span class="challenge-type-badge {% if challenge.challenge_type == 'competitive' %}competitive-badge{% else %}collaborative-badge{% endif %}">
                                    {% if challenge.challenge_type == 'competitive' %}üèÜ Competitive{% else %}ü§ù Collaborative{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>

                    {% if challenge.description %}
                    <p style="color: #6b7280; margin: 15px 0;">{{ challenge.description }}</p>
                    {% endif %}

                    <div class="challenge-stats">
                        <div class="stat-item">
                            <span class="stat-label">Created by:</span>
                            <span class="stat-value">{{ challenge.creator.email }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Participants:</span>
                            <span class="stat-value">{{ challenge.participants.filter_by(status='active').count() }}</span>
                        </div>
                        {% if joined_participants[challenge.id] %}
                        <div class="stat-item">
                            <span class="stat-label">Your Streak:</span>
                            <span class="stat-value">{{ joined_participants[challenge.id].current_streak }} üî•</span>
                        </div>
                        {% endif %}
                    </div>

                    <div class="challenge-actions">
                        <a href="{{ url_for('challenges.detail', challenge_id=challenge.id) }}" class="btn-challenge">
                            View Challenge
                        </a>
                        <a href="{{ url_for('challenges.link_habit', challenge_id=challenge.id) }}" class="btn-challenge-outline btn-challenge">
                            <span>üîó</span> Link Habit
                        </a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">ü§ù</div>
                    <h3>No Challenges Joined Yet</h3>
                    <p>You haven't joined any challenges. Ask a friend to invite you, or create your own!</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

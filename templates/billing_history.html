{% extends "base.html" %}

{% block title %}Billing History - HabitFlow{% endblock %}

{% block extra_css %}
<style>
    h1, h4 {
        color: var(--text-primary);
    }

    .table {
        color: var(--text-primary);
    }

    .table-striped > tbody > tr:nth-of-type(odd) > * {
        background-color: rgba(179, 136, 255, 0.05);
        color: var(--text-primary);
    }

    .table > :not(caption) > * > * {
        border-bottom-color: rgba(179, 136, 255, 0.2);
    }

    thead {
        color: var(--text-secondary);
    }

    .small.text-muted {
        color: var(--text-muted) !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Billing History</h1>

    <div class="row">
        <div class="col-md-10">
            {% if transactions %}
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Transaction ID</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for transaction in transactions %}
                                    <tr>
                                        <td>{{ transaction.transaction_date.strftime('%B %d, %Y') }}</td>
                                        <td>{{ transaction.subscription_type|title }} Subscription</td>
                                        <td>${{ "%.2f"|format(transaction.amount) }} {{ transaction.currency }}</td>
                                        <td>
                                            <span class="badge bg-{{ 'success' if transaction.status == 'completed' else 'danger' if transaction.status == 'failed' else 'warning' }}">
                                                {{ transaction.status|title }}
                                            </span>
                                        </td>
                                        <td class="small text-muted">{{ transaction.provider_transaction_id[:20] }}...</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                {% if pagination.pages > 1 %}
                <div class="row mt-4">
                    <div class="col-md-12">
                        <nav aria-label="Billing pagination">
                            <ul class="pagination justify-content-center">
                                <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                                    <a class="page-link" href="{{ url_for('subscription.billing_history', page=pagination.prev_num) if pagination.has_prev else '#' }}">
                                        Previous
                                    </a>
                                </li>
                                {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                                    {% if page_num %}
                                        <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                                            <a class="page-link" href="{{ url_for('subscription.billing_history', page=page_num) }}">
                                                {{ page_num }}
                                            </a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled">
                                            <span class="page-link">...</span>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                                    <a class="page-link" href="{{ url_for('subscription.billing_history', page=pagination.next_num) if pagination.has_next else '#' }}">
                                        Next
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="alert alert-info">
                    <h4>No billing history yet</h4>
                    <p>Your payment transactions will appear here once you subscribe to a plan.</p>
                    <a href="{{ url_for('subscription.pricing') }}" class="btn btn-primary">
                        View Pricing
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-10">
            <a href="{{ url_for('subscription.manage') }}" class="btn btn-outline-secondary">
                ‚Üê Back to Subscription Management
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% extends "base.html" %}

{% block title %}Leaderboard - HabitFlow{% endblock %}

{% block content %}
<div class="container content-container">
    <!-- Page Header -->
    <div class="text-center mb-5">
        <h1 class="display-5 mb-3">
            <span style="background: linear-gradient(135deg, var(--purple-vibrant), var(--purple-light));
                         -webkit-background-clip: text;
                         -webkit-text-fill-color: transparent;
                         background-clip: text;">
                üèÜ Leaderboard
            </span>
        </h1>
        <p class="text-muted">See how you stack up against the HabitFlow community</p>
    </div>

    <!-- User Stats Card -->
    <div class="row mb-4">
        <div class="col-md-10 mx-auto">
            <div class="card stats-card">
                <div class="card-body">
                    <h5 class="card-title mb-3">Your Stats</h5>
                    <div class="row text-center">
                        <div class="col-6 col-md-3 mb-3">
                            <div class="stat-item">
                                <div class="stat-value">
                                    {% if user_stats.global_rank %}
                                        #{{ user_stats.global_rank }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </div>
                                <div class="stat-label">Global Rank</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="stat-item">
                                <div class="stat-value">{{ user_stats.best_streak }}</div>
                                <div class="stat-label">Best Streak</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="stat-item">
                                <div class="stat-value">{{ user_stats.total_completions }}</div>
                                <div class="stat-label">Total Completions</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="stat-item">
                                <div class="stat-value">{{ user_stats.badge_count }}</div>
                                <div class="stat-label">Badges Earned</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Tabs -->
    <div class="row">
        <div class="col-md-10 mx-auto">
            <ul class="nav nav-pills mb-4 justify-content-center" role="tablist">
                <li class="nav-item">
                    <a class="nav-link {% if current_type == 'global' %}active{% endif %}"
                       href="{{ url_for('gamification.leaderboard', type='global') }}">
                        üî• Streaks
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if current_type == 'completions' %}active{% endif %}"
                       href="{{ url_for('gamification.leaderboard', type='completions') }}">
                        ‚úÖ Completions
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if current_type == 'badges' %}active{% endif %}"
                       href="{{ url_for('gamification.leaderboard', type='badges') }}">
                        üèÖ Badges
                    </a>
                </li>
            </ul>

            <!-- Leaderboard Card -->
            <div class="card leaderboard-card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table leaderboard-table">
                            <thead>
                                <tr>
                                    <th style="width: 80px;">Rank</th>
                                    <th>User</th>
                                    {% if current_type == 'global' %}
                                        <th class="text-center">Best Streak</th>
                                        <th class="text-center">Active Streaks</th>
                                        <th class="text-center">Badges</th>
                                    {% elif current_type == 'completions' %}
                                        <th class="text-center">Completions</th>
                                        <th class="text-center">Habits</th>
                                        <th class="text-center">Badges</th>
                                    {% elif current_type == 'badges' %}
                                        <th class="text-center">Badges</th>
                                        <th class="text-center">Best Streak</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for leader in leaderboard.leaders %}
                                <tr class="{% if leader.is_current_user %}current-user-row{% endif %}">
                                    <td>
                                        <span class="rank-badge">
                                            {{ leader.rank_emoji }} {{ leader.rank }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="user-info">
                                            <span class="username">{{ leader.username }}</span>
                                            {% if leader.is_current_user %}
                                                <span class="badge bg-primary ms-2">You</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    {% if current_type == 'global' %}
                                        <td class="text-center">
                                            <span class="highlight-value">{{ leader.best_streak }}</span> days
                                        </td>
                                        <td class="text-center">{{ leader.active_streaks }}</td>
                                        <td class="text-center">{{ leader.badge_count }}</td>
                                    {% elif current_type == 'completions' %}
                                        <td class="text-center">
                                            <span class="highlight-value">{{ leader.completion_count }}</span>
                                        </td>
                                        <td class="text-center">{{ leader.unique_habits }}</td>
                                        <td class="text-center">{{ leader.badge_count }}</td>
                                    {% elif current_type == 'badges' %}
                                        <td class="text-center">
                                            <span class="highlight-value">{{ leader.badge_count }}</span> üèÖ
                                        </td>
                                        <td class="text-center">{{ leader.best_streak }} days</td>
                                    {% endif %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    {% if leaderboard.leaders|length == 0 %}
                        <div class="text-center py-5 text-muted">
                            <p>No users on this leaderboard yet. Be the first!</p>
                        </div>
                    {% endif %}

                    <div class="text-center mt-3 text-muted">
                        <small>Showing top {{ leaderboard.leaders|length }} of {{ leaderboard.total_users }} users</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .stats-card {
        background: linear-gradient(145deg, #2d3748 0%, #1a202c 100%);
        border: 2px solid rgba(179, 136, 255, 0.4);
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.7), 0 0 25px rgba(124, 58, 237, 0.3);
        padding: 10px;
    }

    body:not(.dark-mode) .stats-card {
        background: linear-gradient(145deg, #ffffff 0%, #faf5ff 100%);
        border: 2px solid #e5e7eb;
        box-shadow: 0 10px 35px rgba(124, 58, 237, 0.12);
    }

    .stat-item {
        padding: 15px 10px;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #b388ff, #7c3aed);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1.2;
    }

    body:not(.dark-mode) .stat-value {
        background: linear-gradient(135deg, #7c3aed, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stat-label {
        color: #d1d5db;
        font-size: 0.95rem;
        margin-top: 8px;
        font-weight: 600;
    }

    body:not(.dark-mode) .stat-label {
        color: #6b7280;
    }

    .nav-pills .nav-link {
        background: linear-gradient(145deg, #2d3748, #1a202c);
        border: 2px solid rgba(179, 136, 255, 0.4);
        color: #e5e7eb;
        margin: 0 8px;
        border-radius: 12px;
        padding: 12px 24px;
        transition: all 0.3s ease;
        font-weight: 700;
        font-size: 1.05rem;
    }

    body:not(.dark-mode) .nav-pills .nav-link {
        background: white;
        border: 2px solid #e5e7eb;
        color: #1f2937;
    }

    .nav-pills .nav-link:hover {
        border-color: #b388ff;
        color: #f9fafb;
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(124, 58, 237, 0.3);
    }

    body:not(.dark-mode) .nav-pills .nav-link:hover {
        border-color: #a78bfa;
        color: #1f2937;
    }

    .nav-pills .nav-link.active {
        background: linear-gradient(135deg, #7c3aed, #b388ff);
        border-color: #b388ff;
        color: white;
        box-shadow: 0 6px 25px rgba(124, 58, 237, 0.5);
    }

    body:not(.dark-mode) .nav-pills .nav-link.active {
        background: linear-gradient(135deg, #7c3aed, #a78bfa);
        border-color: #7c3aed;
    }

    .leaderboard-card {
        background: linear-gradient(145deg, #2d3748 0%, #1a202c 100%);
        border: 2px solid rgba(179, 136, 255, 0.4);
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.7), 0 0 25px rgba(124, 58, 237, 0.3);
        overflow: hidden;
        position: relative;
    }

    .leaderboard-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #7c3aed, #b388ff, #7c3aed);
        background-size: 200% 100%;
        animation: shimmer 3s linear infinite;
    }

    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }

    body:not(.dark-mode) .leaderboard-card {
        background: linear-gradient(145deg, #ffffff 0%, #faf5ff 100%);
        border: 2px solid #e5e7eb;
        box-shadow: 0 10px 35px rgba(124, 58, 237, 0.12);
    }

    body:not(.dark-mode) .leaderboard-card::before {
        background: linear-gradient(90deg, #7c3aed, #b388ff, #7c3aed);
    }

    .leaderboard-table {
        margin-bottom: 0;
    }

    /* Better table styling */
    .table-responsive {
        border-radius: 15px;
        overflow: hidden;
    }

    .leaderboard-table tbody tr:first-child td {
        padding-top: 20px;
    }

    .leaderboard-table tbody tr:last-child {
        border-bottom: none;
    }

    .leaderboard-table thead th {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.3), rgba(179, 136, 255, 0.2)) !important;
        border-bottom: 3px solid #7c3aed !important;
        color: #f9fafb !important;
        font-weight: 800 !important;
        padding: 20px 15px !important;
        font-size: 1.05rem !important;
        text-transform: uppercase !important;
        letter-spacing: 1px !important;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    body:not(.dark-mode) .leaderboard-table thead th {
        background: linear-gradient(135deg, #f3e8ff, #faf5ff) !important;
        border-bottom: 3px solid #7c3aed !important;
        color: #1f2937 !important;
        text-shadow: none;
    }

    .leaderboard-table tbody tr {
        border-bottom: 1px solid rgba(179, 136, 255, 0.2);
        transition: all 0.2s ease;
        color: #f9fafb;
    }

    body:not(.dark-mode) .leaderboard-table tbody tr {
        border-bottom: 1px solid #f3f4f6;
        color: #1f2937;
    }

    .leaderboard-table tbody td {
        color: #f9fafb !important;
        padding: 18px 15px !important;
        font-size: 1.05rem !important;
        font-weight: 600 !important;
    }

    body:not(.dark-mode) .leaderboard-table tbody td {
        color: #1f2937 !important;
    }

    /* Make secondary text (like "days") visible */
    .leaderboard-table tbody td:not(.rank-badge):not(.username) {
        color: #e5e7eb !important;
    }

    body:not(.dark-mode) .leaderboard-table tbody td:not(.rank-badge):not(.username) {
        color: #374151 !important;
    }

    .leaderboard-table tbody tr:hover {
        background-color: rgba(179, 136, 255, 0.15);
        transform: translateX(5px);
    }

    body:not(.dark-mode) .leaderboard-table tbody tr:hover {
        background-color: #faf5ff;
    }

    .current-user-row {
        background: linear-gradient(90deg, rgba(124, 58, 237, 0.3) 0%, rgba(179, 136, 255, 0.2) 100%) !important;
        font-weight: 700;
        border-left: 4px solid #b388ff !important;
    }

    body:not(.dark-mode) .current-user-row {
        background: linear-gradient(90deg, #f3e8ff 0%, #faf5ff 100%) !important;
        border-left: 4px solid #7c3aed !important;
    }

    .current-user-row td {
        color: #f9fafb !important;
    }

    body:not(.dark-mode) .current-user-row td {
        color: #1f2937 !important;
    }

    .rank-badge {
        font-size: 1.3rem;
        font-weight: 900;
        background: linear-gradient(135deg, #b388ff, #7c3aed);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    body:not(.dark-mode) .rank-badge {
        background: linear-gradient(135deg, #7c3aed, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .username {
        font-weight: 600;
        color: #f9fafb;
        font-size: 1.05rem;
    }

    body:not(.dark-mode) .username {
        color: #1f2937;
    }

    .highlight-value {
        font-weight: 900;
        font-size: 1.15rem;
        background: linear-gradient(135deg, #b388ff, #7c3aed);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    body:not(.dark-mode) .highlight-value {
        background: linear-gradient(135deg, #7c3aed, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .badge.bg-primary {
        background: linear-gradient(135deg, #7c3aed, #b388ff) !important;
        padding: 4px 12px;
        font-weight: 700;
        border-radius: 20px;
        font-size: 0.85rem;
    }

    /* Empty state styling */
    .text-muted {
        color: #9ca3af !important;
    }

    body:not(.dark-mode) .text-muted {
        color: #6b7280 !important;
    }

    /* Bottom text */
    .leaderboard-card .text-center.mt-3 small {
        color: #d1d5db !important;
        font-weight: 600 !important;
        font-size: 0.95rem !important;
    }

    body:not(.dark-mode) .leaderboard-card .text-center.mt-3 small {
        color: #6b7280 !important;
    }

    .leaderboard-card .text-center.mt-3 {
        padding: 15px 0;
        border-top: 1px solid rgba(179, 136, 255, 0.2);
        margin-top: 0 !important;
    }

    body:not(.dark-mode) .leaderboard-card .text-center.mt-3 {
        border-top: 1px solid #e5e7eb;
    }

    @media (max-width: 768px) {
        .leaderboard-table {
            font-size: 0.9rem;
        }

        .leaderboard-table tbody td {
            padding: 12px 10px;
        }

        .rank-badge {
            font-size: 1.1rem;
        }

        .stat-value {
            font-size: 2rem;
        }

        .nav-pills .nav-link {
            padding: 10px 16px;
            font-size: 0.95rem;
            margin: 0 4px;
        }
    }
</style>
{% endblock %}

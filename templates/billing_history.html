{% extends "base.html" %}

{% block title %}Billing History - HabitFlow{% endblock %}

{% block extra_css %}
<style>
    h1, h4 {
        color: var(--text-primary);
    }

    .card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 15px var(--shadow-color);
        border-radius: 15px;
    }

    .card-body {
        padding: 30px;
    }

    /* Table styling with better readability */
    .table {
        color: #1a202c;
        font-size: 1rem;
        margin-bottom: 0;
    }

    body.dark-mode .table {
        color: #e5e7eb;
    }

    .table thead th {
        color: #4a5568;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
        border-bottom: 2px solid #e2e8f0;
        padding: 15px;
    }

    body.dark-mode .table thead th {
        color: #9ca3af;
        border-bottom-color: #4a5568;
    }

    .table tbody td {
        color: #2d3748;
        font-weight: 500;
        padding: 18px 15px;
        vertical-align: middle;
        border-bottom: 1px solid #e2e8f0;
    }

    body.dark-mode .table tbody td {
        color: #d1d5db;
        border-bottom-color: #374151;
    }

    .table-striped > tbody > tr:nth-of-type(odd) > * {
        background-color: rgba(124, 58, 237, 0.03);
    }

    body.dark-mode .table-striped > tbody > tr:nth-of-type(odd) > * {
        background-color: rgba(124, 58, 237, 0.08);
    }

    .table tbody tr:hover {
        background-color: rgba(124, 58, 237, 0.08);
        transition: background-color 0.2s ease;
    }

    body.dark-mode .table tbody tr:hover {
        background-color: rgba(124, 58, 237, 0.15);
    }

    /* Transaction ID styling */
    .small.text-muted {
        color: #6b7280 !important;
        font-size: 0.85rem;
        font-family: monospace;
    }

    body.dark-mode .small.text-muted {
        color: #9ca3af !important;
    }

    /* Badge styling */
    .badge {
        padding: 6px 12px;
        font-size: 0.85rem;
        font-weight: 600;
        border-radius: 8px;
    }

    /* Alert styling */
    .alert-info {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(96, 165, 250, 0.1) 100%);
        border: 2px solid #3b82f6;
        border-radius: 15px;
        padding: 25px;
    }

    .alert-info h4 {
        color: #1e40af;
        font-weight: 700;
    }

    .alert-info p {
        color: #1e3a8a;
        font-size: 1.05rem;
    }

    body.dark-mode .alert-info {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(96, 165, 250, 0.2) 100%);
        border-color: #60a5fa;
    }

    body.dark-mode .alert-info h4 {
        color: #60a5fa;
    }

    body.dark-mode .alert-info p {
        color: #bfdbfe;
    }

    /* Button styling */
    .btn-outline-secondary {
        border-color: #6b7280;
        color: #6b7280;
        font-weight: 600;
        border-radius: 10px;
        padding: 10px 25px;
        transition: all 0.3s ease;
    }

    .btn-outline-secondary:hover {
        background: #6b7280;
        border-color: #6b7280;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }

    /* Pagination styling */
    .pagination .page-link {
        color: #7c3aed;
        border-color: #e2e8f0;
        padding: 10px 18px;
        font-weight: 500;
    }

    .pagination .page-link:hover {
        background-color: rgba(124, 58, 237, 0.1);
        border-color: #7c3aed;
        color: #7c3aed;
    }

    .pagination .page-item.active .page-link {
        background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
        border-color: #7c3aed;
    }

    body.dark-mode .pagination .page-link {
        background-color: var(--card-bg);
        border-color: #4a5568;
        color: #a78bfa;
    }

    body.dark-mode .pagination .page-link:hover {
        background-color: rgba(124, 58, 237, 0.2);
        border-color: #a78bfa;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Billing History</h1>

    <div class="row">
        <div class="col-md-10">
            {% if transactions %}
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Transaction ID</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for transaction in transactions %}
                                    <tr>
                                        <td>{{ transaction.transaction_date.strftime('%B %d, %Y') }}</td>
                                        <td>{{ transaction.subscription_type|title }} Subscription</td>
                                        <td>${{ "%.2f"|format(transaction.amount) }} {{ transaction.currency }}</td>
                                        <td>
                                            <span class="badge bg-{{ 'success' if transaction.status == 'completed' else 'danger' if transaction.status == 'failed' else 'warning' }}">
                                                {{ transaction.status|title }}
                                            </span>
                                        </td>
                                        <td class="small text-muted">{{ transaction.provider_transaction_id[:20] }}...</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                {% if pagination.pages > 1 %}
                <div class="row mt-4">
                    <div class="col-md-12">
                        <nav aria-label="Billing pagination">
                            <ul class="pagination justify-content-center">
                                <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                                    <a class="page-link" href="{{ url_for('subscription.billing_history', page=pagination.prev_num) if pagination.has_prev else '#' }}">
                                        Previous
                                    </a>
                                </li>
                                {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                                    {% if page_num %}
                                        <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                                            <a class="page-link" href="{{ url_for('subscription.billing_history', page=page_num) }}">
                                                {{ page_num }}
                                            </a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled">
                                            <span class="page-link">...</span>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                                    <a class="page-link" href="{{ url_for('subscription.billing_history', page=pagination.next_num) if pagination.has_next else '#' }}">
                                        Next
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="alert alert-info">
                    <h4>No billing history yet</h4>
                    <p>Your payment transactions will appear here once you subscribe to a plan.</p>
                    <a href="{{ url_for('subscription.pricing') }}" class="btn btn-primary">
                        View Pricing
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-10">
            <a href="{{ url_for('subscription.manage') }}" class="btn btn-outline-secondary">
                ‚Üê Back to Subscription Management
            </a>
        </div>
    </div>
</div>
{% endblock %}
